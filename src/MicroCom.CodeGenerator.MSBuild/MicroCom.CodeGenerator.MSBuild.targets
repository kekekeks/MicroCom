<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <UsingTask TaskName="MicroComCodeGeneratorTask"  AssemblyFile="$(MSBuildThisFileDirectory)\..\tools\netstandard2.0\MicroCom.CodeGenerator.MSBuild.dll" />
  <!-- Ensure that code generator is actually built -->
  
  <Target Name="GenerateMicroComItems"
          DependsOnTargets="ResolveReferences"
          Inputs="@(MicroComIdl)"
          Outputs="%(MicroComIdl.CSharpInteropPath);%(MicroComIdl.CppHeaderPath)">
    <MicroComCodeGeneratorTask
            RuntimeNamespace="$(MicroComGeneratorRuntimeNamespace)"
            Inputs="@(MicroComIdl)"/>
  </Target>
  
  <Target Name="UpdateMicroComCompileItems" DependsOnTargets="GenerateMicroComItems" BeforeTargets="CoreCompile">
    <!-- Remove and re-add generated file, this is needed for the clean build -->
    <ItemGroup>
      <Compile Remove="%(MicroComIdl.CSharpInteropPath)"/>
      <Compile Include="%(MicroComIdl.CSharpInteropPath)"/>
    </ItemGroup>
  </Target>
  
  <ItemGroup>
    <UpToDateCheckInput Include="@(MicroComIdl)"/>
  </ItemGroup>
</Project>
